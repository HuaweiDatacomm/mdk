# **MDK**

## **Overview**
MDK: Model Driven Kit. It extends Pyangbind that  is a plugin for Pyang that generates a Python class hierarchy from a YANG data
model.  Users can use MDK to connect the Huawei's device. MDK also provides that users can use the python class
generated by Huawei's Yang file,then operate Python class to deliver packets to Huawei's devices. 

## **Installation**
### **Prerequisites**

OS: Ubuntu, CentOS, Suse  
Python: 3.7  
Required Python package:pyang, bitarray, lxml, regex, six, enum34, ncclient, pyangbind

### Build From Source  

1.Clone the mdk repository:
 ```
 git clone https://github.com/HuaweiDatacomm/mdk.git
 ```
2.Install required Python package:
```
 pip3 install -r requirments.txt
 python3 setup.py install
```

## Generate Yang modules to Python Class
put Yang Files in dir yang,then run generate_py.sh,you can get all python classes generated by yang files.

```
cd mdk/yang
chmod +x generate_py.sh
./generate_py.sh
```

## Use Python Class to get configuration of huawei's device
huawei_debug.py is used as an example.  
1.import huawei_debug and mdk.
```
import yang.huawei_debug
import yang.mdk
```
2.create instance object.
```
obj = huawei_debug.huawei_debug() 
kit = mdk.MDK()
```
3.get configuration by MDK.

```
config_obj = kit.getconfig(python_obj=obj.debug, binding=huawei_debug, entrance_name='huawei-debug')
print(config_obj.get())
```
<details markdown="1">
<summary>result:</summary>
{'debug':
<br>{'cpu-infos': 
<br>{'cpu-info': 
<br>OrderedDict([
<br>('3', {'position': '3', 'overload-threshold': 90, 'unoverload-threshold': 75, 'interval': 8, 'index': 0, 'system-cpu-usage': 0, 'monitor-number': 0, 'monitor-cycle': 0, 'overload-state-change-time': '', 'current-overload-state': ''}), 
<br>('4', {'position': '4', 'overload-threshold': 90, 'unoverload-threshold': 75, 'interval': 8, 'index': 0, 'system-cpu-usage': 0, 'monitor-number': 0, 'monitor-cycle': 0, 'overload-state-change-time': '', 'current-overload-state': ''}), 
<br>('17', {'position': '17', 'overload-threshold': 90, 'unoverload-threshold': 75, 'interval': 8, 'index': 0, 'system-cpu-usage': 0, 'monitor-number': 0, 'monitor-cycle': 0, 'overload-state-change-time': '', 'current-overload-state': ''}), 
<br>('18', {'position': '18', 'overload-threshold': 90, 'unoverload-threshold': 75, 'interval': 8, 'index': 0, 'system-cpu-usage': 0, 'monitor-number': 0, 'monitor-cycle': 0, 'overload-state-change-time': '', 'current-overload-state': ''})])}, 
<br>'memory-infos': 
<br>{'memory-info': 
<br>OrderedDict([
<br>('3', {'position': '3', 'overload-threshold': 95, 'unoverload-threshold': 75, 'memreli-notice-threshold': 85, 'memreli-overload-threshold': 95, 'index': 0, 'os-memory-total': 0, 'os-memory-use': 0, 'os-memory-free': 0, 'os-memory-usage': 0, 'do-memory-total': 0, 'do-memory-use': 0, 'do-memory-free': 0, 'do-memory-usage': 0, 'simple-memory-total': 0, 'simple-memory-use': 0, 'simple-memory-free': 0, 'simple-memory-usage': 0, 'overload-state-change-time': '', 'current-overload-state': ''}), 
<br>('4', {'position': '4', 'overload-threshold': 95, 'unoverload-threshold': 75, 'memreli-notice-threshold': 85, 'memreli-overload-threshold': 95, 'index': 0, 'os-memory-total': 0, 'os-memory-use': 0, 'os-memory-free': 0, 'os-memory-usage': 0, 'do-memory-total': 0, 'do-memory-use': 0, 'do-memory-free': 0, 'do-memory-usage': 0, 'simple-memory-total': 0, 'simple-memory-use': 0, 'simple-memory-free': 0, 'simple-memory-usage': 0, 'overload-state-change-time': '', 'current-overload-state': ''}), 
<br>('17', {'position': '17', 'overload-threshold': 95, 'unoverload-threshold': 75, 'memreli-notice-threshold': 85, 'memreli-overload-threshold': 95, 'index': 0, 'os-memory-total': 0, 'os-memory-use': 0, 'os-memory-free': 0, 'os-memory-usage': 0, 'do-memory-total': 0, 'do-memory-use': 0, 'do-memory-free': 0, 'do-memory-usage': 0, 'simple-memory-total': 0, 'simple-memory-use': 0, 'simple-memory-free': 0, 'simple-memory-usage': 0, 'overload-state-change-time': '', 'current-overload-state': ''}), 
<br>('18', {'position': '18', 'overload-threshold': 95, 'unoverload-threshold': 75, 'memreli-notice-threshold': 85, 'memreli-overload-threshold': 95, 'index': 0, 'os-memory-total': 0, 'os-memory-use': 0, 'os-memory-free': 0, 'os-memory-usage': 0, 'do-memory-total': 0, 'do-memory-use': 0, 'do-memory-free': 0, 'do-memory-usage': 0, 'simple-memory-total': 0, 'simple-memory-use': 0, 'simple-memory-free': 0, 'simple-memory-usage': 0, 'overload-state-change-time': '', 'current-overload-state': ''})])}, 
<br>'resouce-reliability': {'memory-reliability': {'enable': False}, 'memory-reliability-switchover-threshold': {'threshold': 70}, 'flow-control-message-reliability': {'enable': True}}, 
<br>'service-cpu-infos': {'service-cpu-info': OrderedDict()}, 'board-resouce-states': {'board-resouce-state': OrderedDict()}}}
</details>

Note: unique key is '3','4','17','18'

4.get details.New objects are added by calling .add() and passing unique key as an argument.
```
memory_info_position3 = obj.debug.memory_infos.memory_info.add('3')
position3 = kit.getconfig(python_obj=obj.debug, binding=huawei_debug, entrance_name='huawei-debug')
print(position3.get())
```
<details markdown="1">
<summary>result:</summary>
{'debug': 
<br>{'cpu-infos': 
<br>{'cpu-info': OrderedDict()}, 
<br>'memory-infos': 
<br>{'memory-info': 
<br>OrderedDict([
<br>('3', {'position': '3', 'overload-threshold': 95, 'unoverload-threshold': 75, 'memreli-notice-threshold': 85, 'memreli-overload-threshold': 95, 'index': 0, 'os-memory-total': 0, 'os-memory-use': 0, 'os-memory-free': 0, 'os-memory-usage': 0, 'do-memory-total': 0, 'do-memory-use': 0, 'do-memory-free': 0, 'do-memory-usage': 0, 'simple-memory-total': 0, 'simple-memory-use': 0, 'simple-memory-free': 0, 'simple-memory-usage': 0, 'overload-state-change-time': '', 'current-overload-state': ''})])}, 'resouce-reliability': {'memory-reliability': {'enable': False}, 'memory-reliability-switchover-threshold': {'threshold': 0}, 'flow-control-message-reliability': {'enable': True}}, 'service-cpu-infos': {'service-cpu-info': OrderedDict()}, 'board-resouce-states': {'board-resouce-state': OrderedDict()}}}

</details>

## Use Python Class to deliver packets to huawei's device
1.update python class
```
position3.debug.memory-infos.memory-info['3'].overload_threshold = 80
```
2.deliver packets
```
xpath = "/ns:debug/ns:memory-infos/ns:memory-info[ns:position='3']"
ns = {'ns': 'urn:huawei:yang:huawei-debug'}
kit.merge(python_obj=obj.debug, xpath=xpath, namespace=ns)
```

<details markdown="1">
<summary>result:</summary>
<rpc-reply message-id="urn:uuid:e949d577-0d58-46e8-9618-0171d4139d7e">
  <ok/>
</rpc-reply>
</details>

xpath: need user to add   
merge: modifies or creates data in the database. This is the default operation.  
create: adds configuration data to the configuration database only if such data does not exist. If the configuration data already exists, is returned, in which the value is data-exists.  
delete: deletes a specified configuration data record from the configuration database. If the data exists, it is deleted. If the data does not exist, is returned, in which the value is data-missing.  
replace: replaces existing data or creates data that does not exist in the database.
