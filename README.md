# **MDK-huawei-gen**

## **Overview**

**PyangBind** is a plugin for [Pyang][pyang] that generates a Python class hierarchy from a YANG data model. The resulting classes can be directly interacted with in Python. Particularly, **PyangBind** will allow you to:

 * Create new data instances - through setting values in the Python class hierarchy.
 * Load data instances from external sources - taking input data from an external source and allowing it to be addressed through the Python classes.
 * Serialise populated objects into formats that can be stored, or sent to another system (e.g., a network element).

Development of **PyangBind** has been motivated by consuming the  [OpenConfig][openconfig] data models; and is intended to be well-tested against these models. The Python classes generated, and serialisation methods are intended to provide network operators with a starting point for loading data instances from network elements, manipulating them, and sending them to a network device. **PyangBind** classes also have functionality which allows additional methods to be associated with the classes, such that it can be used for the foundation of a NMS.

## **Installation**
### **Prerequisites**

OS: Ubuntu, CentOS, Suse  
Python: 3.7  
Required Python package:pyang,bitarray,lxml,regex,six,enum34,ncclient,pyangbind

### Build From Source  

1.Clone the mdk repository:
 ```
 git clone https://github.com/HuaweiDatacomm/mdk.git
 ```
2.Install required Python package:
```
 pip3 install pyangbind
 pip3 install ncclient
 pip3 install -r requirments.txt
 python3 setup.py install
 pip3 list
```

## Generate yang modules to Python Class
put all Yang modules in dir yang,then run generate_py.sh,you can get all python classes generated by yang modules.

```
cd mdk/yang
chmod +x generate_py.sh
./generate_py.sh
```

## Getting Used
Let's explain the methods of defining the main.py.  
1.conn(self): ncclient's connection of device  
2.get_module_filter(self): get one filter of one yang file.  
3.get_allconfig(self): get all configurations of the device.  
4.get_xml(self,filter=None): the rpc_replay is returned in XML format.  
5.get_json(self,filter=None): the rpc_replay is returned in JSON format.  
6.server_capabilities(self): get device's capabilities.  
7.edit(self, filter=None, target='running'): Netconf's eidt_config().  

### First:configure the host,username,password and host  

### Second:check device's capabilities

<details markdown="1">
<summary>get device's capabilities</summary>  

urn:ietf:params:netconf:base:1.0
urn:ietf:params:netconf:base:1.1
urn:ietf:params:netconf:capability:writable-running:1.0
urn:ietf:params:netconf:capability:candidate:1.0
urn:ietf:params:netconf:capability:confirmed-commit:1.0
urn:ietf:params:netconf:capability:confirmed-commit:1.1
urn:ietf:params:netconf:capability:with-defaults:1.0?basic-mode=report-all&also-supported=report-all-tagged,trim
http://www.huawei.com/netconf/capability/discard-commit/1.0
urn:ietf:params:netconf:capability:xpath:1.0
urn:ietf:params:netconf:capability:startup:1.0
urn:ietf:params:netconf:capability:rollback-on-error:1.0
http://www.huawei.com/netconf/capability/sync/1.3
http://www.huawei.com/netconf/capability/sync/1.2
http://www.huawei.com/netconf/capability/sync/1.1
http://www.huawei.com/netconf/capability/sync/1.0
http://www.huawei.com/netconf/capability/exchange/1.0
http://www.huawei.com/netconf/capability/exchange/1.2
http://www.huawei.com/netconf/capability/sync-config/1.1
http://www.huawei.com/netconf/capability/sync-config/1.0
http://www.huawei.com/netconf/capability/active/1.0
urn:ietf:params:netconf:capability:validate:1.0
urn:ietf:params:netconf:capability:validate:1.1
http://www.huawei.com/netconf/capability/action/1.0
http://www.huawei.com/netconf/capability/execute-cli/1.0
http://www.huawei.com/netconf/capability/update/1.0
http://www.huawei.com/netconf/capability/commit-description/1.0
urn:ietf:params:netconf:capability:url:1.0?scheme=file,ftp,sftp,http,https
http://www.huawei.com/netconf/capability/schema/1.0
urn:ietf:params:netconf:capability:notification:1.0
urn:ietf:params:netconf:capability:interleave:1.0
urn:ietf:params:netconf:capability:notification:2.0
urn:ietf:params:netconf:capability:yang-library:1.0?revision=2016-06-21&module-set-id=4174772494
...  
</details>

### Third:configure the YANG module filter.Here is an example of huawei-debug.py.
def get_module_filter(self):
   huawei_obj = ***huawei_debug()***  
   xml = pybindIETFXMLEncoder.serialise(huawei_obj.***debug***)

### Fourth: run main.py
```
python3 main.py
```

### Fifth: check json.txt and xml.txt
<details markdown="1">
<summary>json</summary>  
{
 "data": {
  "@xmlns": "urn:ietf:params:xml:ns:netconf:base:1.0",
  "debug": {
   "@xmlns": "urn:huawei:yang:huawei-debug",
   "cpu-infos": {
    "cpu-info": [
     {
      "position": "3",
      "overload-threshold": "90",
      "unoverload-threshold": "75",
      "interval": "8",
      "index": "16973825",
      "system-cpu-usage": "18",
      "monitor-number": "48",
      "monitor-cycle": "10",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     },
     {
      "position": "4",
      "overload-threshold": "90",
      "unoverload-threshold": "75",
      "interval": "8",
      "index": "17039361",
      "system-cpu-usage": "18",
      "monitor-number": "48",
      "monitor-cycle": "10",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     },
     {
      "position": "17",
      "overload-threshold": "90",
      "unoverload-threshold": "75",
      "interval": "8",
      "index": "17891329",
      "system-cpu-usage": "18",
      "monitor-number": "48",
      "monitor-cycle": "10",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     },
     {
      "position": "18",
      "overload-threshold": "90",
      "unoverload-threshold": "75",
      "interval": "8",
      "index": "17956865",
      "system-cpu-usage": "18",
      "monitor-number": "48",
      "monitor-cycle": "10",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     }
    ]
   },
   "memory-infos": {
    "memory-info": [
     {
      "position": "3",
      "overload-threshold": "95",
      "unoverload-threshold": "75",
      "memreli-notice-threshold": "85",
      "memreli-overload-threshold": "95",
      "index": "16973825",
      "os-memory-total": "8159012",
      "os-memory-use": "3566552",
      "os-memory-free": "4592460",
      "os-memory-usage": "43",
      "do-memory-total": "5376",
      "do-memory-use": "54",
      "do-memory-free": "5322",
      "do-memory-usage": "1",
      "simple-memory-total": "0",
      "simple-memory-use": "0",
      "simple-memory-free": "0",
      "simple-memory-usage": "0",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     },
     {
      "position": "4",
      "overload-threshold": "95",
      "unoverload-threshold": "75",
      "memreli-notice-threshold": "85",
      "memreli-overload-threshold": "95",
      "index": "17039361",
      "os-memory-total": "8159012",
      "os-memory-use": "3566300",
      "os-memory-free": "4592712",
      "os-memory-usage": "43",
      "do-memory-total": "5376",
      "do-memory-use": "54",
      "do-memory-free": "5322",
      "do-memory-usage": "1",
      "simple-memory-total": "0",
      "simple-memory-use": "0",
      "simple-memory-free": "0",
      "simple-memory-usage": "0",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     },
     {
      "position": "17",
      "overload-threshold": "95",
      "unoverload-threshold": "75",
      "memreli-notice-threshold": "85",
      "memreli-overload-threshold": "95",
      "index": "17891329",
      "os-memory-total": "8159012",
      "os-memory-use": "3566048",
      "os-memory-free": "4592964",
      "os-memory-usage": "43",
      "do-memory-total": "34048",
      "do-memory-use": "342",
      "do-memory-free": "33706",
      "do-memory-usage": "1",
      "simple-memory-total": "0",
      "simple-memory-use": "0",
      "simple-memory-free": "0",
      "simple-memory-usage": "0",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     },
     {
      "position": "18",
      "overload-threshold": "95",
      "unoverload-threshold": "75",
      "memreli-notice-threshold": "85",
      "memreli-overload-threshold": "95",
      "index": "17956865",
      "os-memory-total": "8159012",
      "os-memory-use": "3565576",
      "os-memory-free": "4593436",
      "os-memory-usage": "43",
      "do-memory-total": "34048",
      "do-memory-use": "342",
      "do-memory-free": "33706",
      "do-memory-usage": "1",
      "simple-memory-total": "0",
      "simple-memory-use": "0",
      "simple-memory-free": "0",
      "simple-memory-usage": "0",
      "overload-state-change-time": "0000-00-00 00:00:00",
      "current-overload-state": "Unoverload"
     }
    ]
   },
   "resouce-reliability": {
    "memory-reliability": {
     "enable": "false"
    },
    "memory-reliability-switchover-threshold": {
     "threshold": "70"
    },
    "flow-control-message-reliability": {
     "enable": "true"
    }
   },
   "service-cpu-infos": {
    "service-cpu-info": [
     {
      "position": "17",
      "service-name": "CMF",
      "service-cpu-usage": "13"
     },
     {
      "position": "17",
      "service-name": "SYSTEM",
      "service-cpu-usage": "5"
     },
     {
      "position": "17",
      "service-name": "AAA",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "ARP",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "DEVICE",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "DHCP",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "ETRUNK",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "EUM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "FEA",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "FEC",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "FIBRESM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "IFM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "IP STACK",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "LINK",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "LOCAL PKT",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "MFLP",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "MSTP",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "ND",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "OAM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "OSPF",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "PKI",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "PNP",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "RBS",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "RGM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "RM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "SLA",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "SMLK",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "SVRO",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "TNLM",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "TUNNEL",
      "service-cpu-usage": "0"
     },
     {
      "position": "17",
      "service-name": "VLAN",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "SYSTEM",
      "service-cpu-usage": "18"
     },
     {
      "position": "18",
      "service-name": "AAA",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "ARP",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "CMF",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "DEVICE",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "DHCP",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "ETRUNK",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "EUM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "FEA",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "FEC",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "FIBRESM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "IFM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "IP STACK",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "LINK",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "LOCAL PKT",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "MFLP",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "MSTP",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "ND",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "OAM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "OSPF",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "PKI",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "PNP",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "RBS",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "RGM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "RM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "SLA",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "SMLK",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "SVRO",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "TNLM",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "TUNNEL",
      "service-cpu-usage": "0"
     },
     {
      "position": "18",
      "service-name": "VLAN",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "SYSTEM",
      "service-cpu-usage": "18"
     },
     {
      "position": "3",
      "service-name": "ARP",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "CMF",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "DEVICE",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "DHCP",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "FEA",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "FEC",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "IP STACK",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "LINK",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "LLDP",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "LOCAL PKT",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "ND",
      "service-cpu-usage": "0"
     },
     {
      "position": "3",
      "service-name": "SVRO",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "SYSTEM",
      "service-cpu-usage": "18"
     },
     {
      "position": "4",
      "service-name": "ARP",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "CMF",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "DEVICE",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "DHCP",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "FEA",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "FEC",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "IP STACK",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "LINK",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "LLDP",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "LOCAL PKT",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "ND",
      "service-cpu-usage": "0"
     },
     {
      "position": "4",
      "service-name": "SVRO",
      "service-cpu-usage": "0"
     }
    ]
   },
   "board-resouce-states": {
    "board-resouce-state": [
     {
      "position": "17",
      "entity-index": "17891329",
      "board-name": "CR52MPUB 17",
      "cpu-usage": "18",
      "memory-total-size": "8159012",
      "memory-used-size": "3565796",
      "memory-usage": "43"
     },
     {
      "position": "3",
      "entity-index": "16973825",
      "board-name": "LPUE 3",
      "cpu-usage": "18",
      "memory-total-size": "8159012",
      "memory-used-size": "3566804",
      "memory-usage": "43"
     },
     {
      "position": "4",
      "entity-index": "17039361",
      "board-name": "LPUE 4",
      "cpu-usage": "18",
      "memory-total-size": "8159012",
      "memory-used-size": "3567308",
      "memory-usage": "43"
     },
     {
      "position": "18",
      "entity-index": "17956865",
      "board-name": "CR52MPUB 18",
      "cpu-usage": "18",
      "memory-total-size": "8159012",
      "memory-used-size": "3566552",
      "memory-usage": "43"
     }
    ]
   }
  }
 }
}

</details>

<details markdown="1">
<summary>xml</summary>  

<?xml version="1.0" encoding="UTF-8"?>
      <cpu-infos>
        <cpu-info>
          <position>3</position>
          <overload-threshold>90</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <interval>8</interval>
        </cpu-info>
        <cpu-info>
          <position>4</position>
          <overload-threshold>90</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <interval>8</interval>
        </cpu-info>
        <cpu-info>
          <position>17</position>
          <overload-threshold>90</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <interval>8</interval>
        </cpu-info>
        <cpu-info>
          <position>18</position>
          <overload-threshold>90</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <interval>8</interval>
        </cpu-info>
      </cpu-infos>
      <memory-infos>
        <memory-info>
          <position>3</position>
          <overload-threshold>95</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <memreli-notice-threshold>85</memreli-notice-threshold>
          <memreli-overload-threshold>95</memreli-overload-threshold>
        </memory-info>
        <memory-info>
          <position>4</position>
          <overload-threshold>95</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <memreli-notice-threshold>85</memreli-notice-threshold>
          <memreli-overload-threshold>95</memreli-overload-threshold>
        </memory-info>
        <memory-info>
          <position>17</position>
          <overload-threshold>95</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <memreli-notice-threshold>85</memreli-notice-threshold>
          <memreli-overload-threshold>95</memreli-overload-threshold>
        </memory-info>
        <memory-info>
          <position>18</position>
          <overload-threshold>95</overload-threshold>
          <unoverload-threshold>75</unoverload-threshold>
          <memreli-notice-threshold>85</memreli-notice-threshold>
          <memreli-overload-threshold>95</memreli-overload-threshold>
        </memory-info>
      </memory-infos>
      <resouce-reliability>
        <memory-reliability>
          <enable>false</enable>
        </memory-reliability>
        <memory-reliability-switchover-threshold>
          <threshold>70</threshold>
        </memory-reliability-switchover-threshold>
        <flow-control-message-reliability>
          <enable>true</enable>
        </flow-control-message-reliability>
      </resouce-reliability>
</details>

### Sixth: If you want to perform exact query, you must manually configure the filter.For example,only want to know position is 3 ,Compile the filter based on the xml.txt file.
```
  detail_filter = '''<filter>
  <debug xmlns="urn:huawei:yang:huawei-debug">
      <cpu-infos>
        <cpu-info>
          <position>3</position>
        </cpu-info>
      </cpu-infos>
  </debug>
  </filter>'''
```

### Seventh:configure config string deliver them to the device. add 'xmlns:xc="urn:ietf:params:xml:ns:netconf:base:1.0" xc:operation="merge"'.If display ok, it is successfully.
operation:merge,create,delete,remove,replace    
***merge***: modifies or creates data in the database. This is the default operation.  
***create***: adds configuration data to the configuration database only if such data does not exist. If the configuration data already exists, <rpc-error> is returned, in which the <error-tag> value is data-exists.  
***delete***: deletes a specified configuration data record from the configuration database. If the data exists, it is deleted. If the data does not exist, <rpc-error> is returned, in which the <error-tag> value is data-missing.  
***remove***: removes a specified configuration data record from the configuration database. If the data exists, it is deleted. If the data does not exist, a success message is returned.  
***replace***: replaces existing data or creates data that does not exist in the database.
```
config = '''<config>
  <debug xmlns="urn:huawei:yang:huawei-debug">
      <cpu-infos>
        <cpu-info xmlns:xc="urn:ietf:params:xml:ns:netconf:base:1.0" xc:operation="merge">
          <position>3</position>
          <overload-threshold>80</overload-threshold>
          <unoverload-threshold>65</unoverload-threshold>
          <interval>10</interval>
        </cpu-info>
      </cpu-infos>
    </debug>
  </config>
  '''
```
```
res = conn.edit(config)
     print(res)
```
